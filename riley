#!/bin/bash
# Riley - Product Owner Persona
# User stories, value propositions, prioritisation

# Color codes
GREEN='\033[0;32m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if we're in a research/project vault
if [ ! -f "CLAUDE.md" ] || [ ! -f "_meta/research-log.md" ]; then
    echo -e "${YELLOW}Hi! I'm Riley, your product owner.${NC}"
    echo ""
    echo "It looks like you're not in a research/project vault."
    echo ""
    echo "To start:"
    echo "  1. Create a vault: ./setup-vault.sh ~/vaults/my-project"
    echo "  2. Navigate to it: cd ~/vaults/my-project"
    echo "  3. Launch me: riley"
    echo ""
    exit 1
fi

# Welcome message
echo -e "${MAGENTA}+========================================================+${NC}"
echo -e "${MAGENTA}|                                                        |${NC}"
echo -e "${MAGENTA}|  Hi! I'm Riley - your product owner                   |${NC}"
echo -e "${MAGENTA}|                                                        |${NC}"
echo -e "${MAGENTA}|  User Value * Prioritisation * Product Thinking       |${NC}"
echo -e "${MAGENTA}|                                                        |${NC}"
echo -e "${MAGENTA}+========================================================+${NC}"
echo ""

# Read vault name from CLAUDE.md if possible
VAULT_NAME=$(grep "^# " CLAUDE.md 2>/dev/null | head -1 | sed 's/^# //' | sed 's/ - Research Context$//')
if [ -n "$VAULT_NAME" ]; then
    echo -e "${BLUE}Project:${NC} $VAULT_NAME"
else
    echo -e "${BLUE}Project:${NC} $(basename $(pwd))"
fi

# Show recent user stories if any exist
if [ -d "product/user-stories" ]; then
    STORY_COUNT=$(find product/user-stories -name "*.md" 2>/dev/null | wc -l)
    if [ "$STORY_COUNT" -gt 0 ]; then
        echo -e "${BLUE}User stories:${NC} $STORY_COUNT documented"
        echo "Recent:"
        ls -t product/user-stories/*.md 2>/dev/null | head -3 | while read file; do
            TITLE=$(grep "^# " "$file" | head -1 | sed 's/^# //')
            echo "  - $TITLE"
        done
        echo ""
    fi
fi

echo -e "${YELLOW}I can help with:${NC}"
echo "  - Writing user stories"
echo "  - Defining value propositions"
echo "  - Prioritising features (MoSCoW, RICE)"
echo "  - Understanding user needs"
echo "  - Product roadmaps"
echo ""
echo -e "${YELLOW}Quick start:${NC}"
echo '  "Write user stories for [feature area]"'
echo '  "Prioritise these features: [list]"'
echo '  "What user problem does [idea] solve?"'
echo '  "Create a value hypothesis for [assumption]"'
echo ""
echo -e "${YELLOW}First time in this vault?${NC}"
echo '  "Read CLAUDE.md to understand this project,"'
echo '  "then help me with [product task]"'
echo ""
echo -e "${YELLOW}Collaboration:${NC}"
echo "  - I build on Laura's research"
echo "  - I work with Alex on feasibility"
echo "  - I focus on user value, always"
echo ""
echo -e "${MAGENTA}Let's build the right thing!${NC}"
echo ""

# Launch Claude Code
claude
